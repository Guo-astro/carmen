language: cpp

compiler:
- gcc

env:
  matrix:
  - NODE_NVM_VERSION="0.10"
  - NODE_NVM_VERSION="0.8"
  global:
  - node_pre_gyp_accessKeyId: AKIAJBPMCF2RIVXM3O7Q
  - secure: "W/3NZU0p9VlQ7vQO8mHGROuXkl12f9q2nU/+EwxHAV60r8tSPZBv8kBu16rdUH/hhM1Z7ThJ4oiettvqx7HnHE/YrNCmki5m/IyjXEnQg0tppkgPGz+bCeMoaUs2D24a+hQwUDOLxv+1TOuy+btGoZlCAeiO0vo3p2J43Y9gEfE="

before_install:
# here we set up the node version on the fly based on the matrix value.
# This is done manually so that it is easy to flip the 'language' to
# objective-c in another branch (to run the same travis.yml on OS X)
- git clone https://github.com/creationix/nvm.git ../.nvm
- source ../.nvm/nvm.sh
- nvm install $NODE_NVM_VERSION
- nvm use $NODE_NVM_VERSION
- node --version
- npm --version
# carmen build dependencies
- sudo add-apt-repository --yes ppa:ubuntu-toolchain-r/test
- sudo add-apt-repository --yes ppa:chris-lea/protobuf
- sudo apt-get update
- sudo apt-get install gcc-4.8 g++-4.8 libprotobuf7 libprotobuf-dev protobuf-compiler
- ./scripts/install-dbs.sh

install:
- CXX=g++-4.8 npm install
- CXX=g++-4.8 npm install --build-from-source

after_success:
- ./test/build-publish.sh
