machine:
  node:
    version: 6
  pre:
  - sudo add-apt-repository --yes ppa:ubuntu-toolchain-r/test; sudo apt-get -y update; sudo apt-get -y install libstdc++-5-dev gcc-4.8 g++-4.8; export CXX=g++-4.8
test:
  override:
    - npm run lint
    - ./node_modules/@mapbox/carmen-cache/scripts/setup.sh --config local.env
    - rm -rf "./node_modules/@mapbox/carmen-cache"
    - source local.env && export CXXFLAGS="${MASON_SANITIZE_CXXFLAGS}" && export LDFLAGS="${MASON_SANITIZE_LDFLAGS}" && V=1 npm install @mapbox/carmen-cache --debug --loglevel=http --build-from-source
    - source local.env && export LD_PRELOAD=${MASON_LLVM_RT_PRELOAD} && export ASAN_OPTIONS=fast_unwind_on_malloc=0:${ASAN_OPTIONS} && node node_modules/.bin/tape test/*.js
