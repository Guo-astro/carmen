<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

### Table of Contents

-   [Main](#main)
    -   [Geocoder](#geocoder)
        -   [Geocoder#geocode](#geocodergeocode)
        -   [Geocoder#index](#geocoderindex)
        -   [Geocoder#merge](#geocodermerge)
        -   [Geocoder#multimerge](#geocodermultimerge)
    -   [CarmenSource](#carmensource)
    -   [MemSource](#memsource)
    -   [MemSource](#memsource-1)
    -   [PatternReplaceMap](#patternreplacemap)
-   [Geocoding](#geocoding)
    -   [geocode](#geocode)
    -   [phrasematch](#phrasematch)
    -   [spatialmatch](#spatialmatch)
    -   [verifymatch](#verifymatch)
-   [Indexing](#indexing)
    -   [index](#index)
    -   [analyze](#analyze)
    -   [merge](#merge)
        -   [Document Merge](#document-merge)
        -   [RocksDB grid and freq caches](#rocksdb-grid-and-freq-caches)
        -   [DAWG merge](#dawg-merge)
    -   [multimerge](#multimerge)
-   [Text Processing](#text-processing)
    -   [ReplaceRule](#replacerule)
    -   [createGlobalReplacer](#createglobalreplacer)
    -   [createReplacer](#createreplacer)

## Main

Central API elements, used in geocoding and indexing


### Geocoder

[index.js:55-339](https://github.com/mapbox/carmen/blob/3f3492d1b5bec91dd971fbe132ce847502eb99ed/index.js#L55-L339 "Source code on GitHub")

Geocoder is an interface used to submit a single query to
multiple indexes, returning a single set of ranked results.

**Parameters**

-   `indexes` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)&lt;[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String), [CarmenSource](#carmensource)>** A one-to-one mapping from index layer name to a [CarmenSource](#carmensource).
-   `options` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** options
    -   `options.tokens` **[PatternReplaceMap](#patternreplacemap)** A [PatternReplaceMap](#patternreplacemap) used to perform custom string replacement at index and query time.
    -   `options.geocoder_inverse_tokens` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)&lt;[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String), ([string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String) \| [Function](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function))>** for reversing abbreviations. Replace key with a stipulated string value or pass it to a function that returns a string. see [Text Processing](#text-processsing) for details.

#### Geocoder#geocode

[index.js:426-432](https://github.com/mapbox/carmen/blob/3f3492d1b5bec91dd971fbe132ce847502eb99ed/index.js#L426-L432 "Source code on GitHub")

-   **See: [gecode](#geocode) for more details, including
    `options` properties.**

Main entry point for geocoding API. Returns results across all indexes for
a given query.

**Parameters**

-   `query` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** a query string, eg "Chester, NJ"
-   `options` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** options
-   `callback` **[function](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function)** a callback function, passed on to [geocode](#geocode)

#### Geocoder#index

[index.js:451-457](https://github.com/mapbox/carmen/blob/3f3492d1b5bec91dd971fbe132ce847502eb99ed/index.js#L451-L457 "Source code on GitHub")

-   **See: [index](#index) for more details, including `options` properties.**

Main entry point for indexing. Index a stream of GeoJSON docs.

**Parameters**

-   `from` **[stream.Readable](https://nodejs.org/api/stream.html#stream_class_stream_readable)** a readable stream of GeoJSON features
-   `to` **[CarmenSource](#carmensource)** the interface to the index's destination
-   `options` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** options
    -   `options.zoom` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** the max zoom level for the index
    -   `options.output` **[stream.Writable](https://nodejs.org/api/stream.html#stream_class_stream_writable)** the output stream for
    -   `options.tokens` **[PatternReplaceMap](#patternreplacemap)** a pattern-based string replacement specification
-   `callback` **[function](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function)** a callback function, passed on to [inde](#index)

#### Geocoder#merge

[index.js:473-479](https://github.com/mapbox/carmen/blob/3f3492d1b5bec91dd971fbe132ce847502eb99ed/index.js#L473-L479 "Source code on GitHub")

-   **See: [merge](#merge) for more details, including `options` properties.**

Merge two CarmenSources and output to a third.

**Parameters**

-   `from1` **[CarmenSource](#carmensource)** a source index to be merged
-   `from2` **[CarmenSource](#carmensource)** another source to be merged
-   `to` **[CarmenSource](#carmensource)** the destination of the merged sources
-   `options` **[object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** options
-   `callback` **[function](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function)** a callback function

#### Geocoder#multimerge

[index.js:494-500](https://github.com/mapbox/carmen/blob/3f3492d1b5bec91dd971fbe132ce847502eb99ed/index.js#L494-L500 "Source code on GitHub")

-   **See: [multimerge](#multimerge) for more details, including `options` properties.**

Merge more than two CarmenSources. Only supports MBTile sources.

**Parameters**

-   `fromFiles` **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)>** array of paths to input mbtiles files
-   `toFile` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** path to output of merge
-   `options` **[object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** options
-   `callback` **[function](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function)** a callback function

### CarmenSource

[index.js:55-339](https://github.com/mapbox/carmen/blob/3f3492d1b5bec91dd971fbe132ce847502eb99ed/index.js#L55-L339 "Source code on GitHub")

An interface to the underlying data that a [Geocoder](#geocoder) instance is indexing and querying. In addition to the properties described below, instances must satisfy interface requirements for `Tilesource` and `Tilesink`. See tilelive [API Docs](https://github.com/mapbox/tilelive/blob/master/API.md) for more info. Currently, carmen supports the following tilelive modules:

-   [tilelive-s3](https://github.com/mapbox/tilelive-s3)
-   [node-mbtiles](https://github.com/mapbox/node-mbtiles)
-   [MemSource](#memsource)

Type: [function](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function)

**Properties**

-   `getGeocoderData` **function ([index](#index), shard, callback)** get carmen record at `shard` in `index` and call callback with `(err, buffer)`
-   `putGeocoderData` **function ([index](#index), shard, [buffer](https://nodejs.org/api/buffer.html), callback)** put buffer into a shard with index `index`, and call callback with `(err)`
-   `geocoderDataIterator` **function (type)** custom method for iterating over documents in the source.
-   `getIndexableDocs` **function (pointer, callback)** get documents needed to create a forward geocoding datasource. `pointer` is an optional object that has different behavior depending on the implementation. It is used to indicate the state of the database, similar to a cursor, and can allow pagination, limiting, etc. `callback` is called with `(error, documents, pointer)` in which `documents` is a list of objects.

### MemSource

[lib/sources/api-mem.js:27-47](https://github.com/mapbox/carmen/blob/3f3492d1b5bec91dd971fbe132ce847502eb99ed/lib/sources/api-mem.js#L27-L47 "Source code on GitHub")

An in-memory tilelive source/sink. Used primarily for testing purposes when instantiating a geocoder. Satisfies API constraints documented [here](https://github.com/mapbox/tilelive/blob/master/API.md). If there are three arguments:

**Parameters**

-   `docs` **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)** an array of GeoJSON features to be indexed, or an object with index metadata
-   `info` **[object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** an object with index metadata, or a callback function
-   `callback` **[function](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function)** a callback function

### MemSource

[lib/sources/api-mem.js:27-47](https://github.com/mapbox/carmen/blob/3f3492d1b5bec91dd971fbe132ce847502eb99ed/lib/sources/api-mem.js#L27-L47 "Source code on GitHub")

(See above). If there are two arguments:

**Parameters**

-   `docs` **[object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** an object with index metadata (gets re-assigned to `info`)
-   `info` **[function](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function)** a callback function (gets re-assigned to `callback`)
-   `callback` **[undefined](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/undefined)** undefined

### PatternReplaceMap

[lib/text-processing/token.js:260-275](https://github.com/mapbox/carmen/blob/3f3492d1b5bec91dd971fbe132ce847502eb99ed/lib/text-processing/token.js#L260-L275 "Source code on GitHub")

A mapping from patterns (keys) to replacements (values).

-   The patterns are used in [createGlobalReplacer](#createglobalreplacer) to create `XRegExp`s (case-insensitive)
-   Patterns can match anywhere in a string, regardless of whether the match is a full word, multiple words, or part of a word.
-   Matching substrings are replaced with the associated replacement

This map is used on input strings at both query and index time.

**Example use case: Abbreviating multiple words:**

There are a lot of different ways to write "post office box" in US Addresses. You can normalize them with a pattern replace entry:

```javascript
patternReplaceMap = {
    "\\bP\\.?\\ ?O\\.? Box ([0-9]+)\\b": " pob-$1 "
}

// "P.O. Box 985" -> "pob-985"
// "PO Box 985"   -> "pob-985"
// "p.o. box 985" -> "pob-985"
```

Type: [Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)&lt;[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String), [string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)>

## Geocoding

Functions in use when querying indexes. Most commonly used in a production setting.


### geocode

[lib/geocoder/geocode.js:41-161](https://github.com/mapbox/carmen/blob/3f3492d1b5bec91dd971fbe132ce847502eb99ed/lib/geocoder/geocode.js#L41-L161 "Source code on GitHub")

Main interface for querying an index and returning ranked results.

**Parameters**

-   `geocoder` **[Geocoder](#geocoder)** the geocoder itself
-   `query` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** a query string. If the query appears to be a longitude, latitude pair (eg "-75.1327,40.0115"), it is assumed to be a reverse query.
-   `options` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** options
    -   `options.proximity` **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)>?** a `[ lon, lat ]` array to use for biasing search results. Features closer to the proximity value will be given priority over those further from the proximity value.
    -   `options.types` **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)>?** an array of string types. Only features matching one of the types specified will be returned.
    -   `options.language` **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)>?** One or more [ISO 639-1 codes](https://en.wikipedia.org/wiki/List_of_ISO_639-1_codes), separated by commas to be displayed. Only the first language code is used when prioritizing forward geocode results to be matched. If `carmen:text_{lc}` and/or `geocoder_format_{lc}` are available on a features, response will be returned in that language and appropriately formatted.
    -   `options.languageMode` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?** string. If set to `"strict"` the returned features will be filtered to only those with text matching the language specified by the
    -   `options.bbox` **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)>?** a `[ w, s, e, n ]` bbox array to use for limiting search results. Only features inside the provided bbox will be included.
    -   `options.limit` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Adjust the maximium number of features returned. (optional, default `5`)
    -   `options.allow_dupes` **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** If true, carmen will allow features with identical place names to be returned. (optional, default `false`)
    -   `options.debug` **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** If true, the carmen debug object will be returned as part of the results and internal carmen properties will be preserved on feature output. (optional, default `false`)
    -   `options.stats` **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** If true, the carmen stats object will be returned as part of the results. (optional, default `false`)
    -   `options.indexes` **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** If true, indexes will be returned as part of the results. (optional, default `false`)
    -   `options.autocomplete` **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** If true, indexes will be returned as part of the results. (optional, default `true`)
    -   `options.reverseMode` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** Choices are `'distance'`, `'score'`. Affects the way that a result's context array is built (optional, default `'distance'`)
    -   `options.routing` **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** If true, routable_points will be returned as part of the results for features whose sources are flagged as `geocoder_routable` in the tile json. (optional, default `false`)
-   `callback` **[function](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function)** a callback function

### phrasematch

[lib/geocoder/phrasematch.js:19-121](https://github.com/mapbox/carmen/blob/3f3492d1b5bec91dd971fbe132ce847502eb99ed/lib/geocoder/phrasematch.js#L19-L121 "Source code on GitHub")

phrasematch

**Parameters**

-   `source` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** a Geocoder datasource
-   `query`  
-   `options` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** passed through the geocode function in geocode.js
-   `callback` **[Function](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function)** called with `(err, phrasematches, source)`
-   `a` **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)** list of terms composing the query to Carmen

### spatialmatch

[lib/geocoder/spatialmatch.js:27-124](https://github.com/mapbox/carmen/blob/3f3492d1b5bec91dd971fbe132ce847502eb99ed/lib/geocoder/spatialmatch.js#L27-L124 "Source code on GitHub")

spatialmatch determines whether indexes can be spatially stacked and discards indexes that cannot be stacked together

**Parameters**

-   `query` **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)** a list of terms composing the query to Carmen
-   `phrasematchResults` **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)** for subquery permutations generated by ./lib/phrasematch
-   `options` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** passed in with the query
-   `callback` **[function](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function)** callback called with indexes that could be spatially stacked

### verifymatch

[lib/geocoder/verifymatch.js:31-94](https://github.com/mapbox/carmen/blob/3f3492d1b5bec91dd971fbe132ce847502eb99ed/lib/geocoder/verifymatch.js#L31-L94 "Source code on GitHub")

verifymatch - results from spatialmatch are now verified by querying real geometries in vector tiles

**Parameters**

-   `query` **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)** a list of terms composing the query to Carmen
-   `stats` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** ?
-   `geocoder` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** a geocoder datasource
-   `matched` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** resultant indexes that could be spatially stacked
-   `options` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** passed through the geocode function in geocode.js
-   `callback` **[Function](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function)** callback function which is called with the verified indexes in the correct hierarchical order

## Indexing

Functions dedicated toward building and manipulating indexes.


### index

[lib/indexer/index.js:30-97](https://github.com/mapbox/carmen/blob/3f3492d1b5bec91dd971fbe132ce847502eb99ed/lib/indexer/index.js#L30-L97 "Source code on GitHub")

The main interface for building an index

**Parameters**

-   `geocoder` **[Geocoder](#geocoder)** a [Geocoder](#geocoder) instance
-   `from` **[stream.Readable](https://nodejs.org/api/stream.html#stream_class_stream_readable)** a stream of geojson features
-   `to` **[CarmenSource](#carmensource)** the interface to the index's destinaton
-   `options` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** options
    -   `options.zoom` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** the max zoom level for the index
    -   `options.output` **[stream.Writable](https://nodejs.org/api/stream.html#stream_class_stream_writable)** the output stream for
    -   `options.tokens` **[PatternReplaceMap](#patternreplacemap)** a pattern-based string replacement specification
-   `callback` **[function](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function)** A callback function

### analyze

[lib/util/analyze.js:23-55](https://github.com/mapbox/carmen/blob/3f3492d1b5bec91dd971fbe132ce847502eb99ed/lib/util/analyze.js#L23-L55 "Source code on GitHub")

Generate summary statistics about a source. Used by `scripts/carmen-analyze.js`.

Summary stats include:

| statistic | type                      | description                                                                                                                                 |
| --------- | ------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------- |
| `total`   | number                    | the total number of grids                                                                                                                   |
| `byScore` | Object&lt;string, number> | grid counts, grouped by grid score value (from `"1"` to `"6"`)                                                                              |
| `byRelev` | Object&lt;string, number> | grid counts, grouped by grid revelance. group labels reflect the relevance value, rounded to the nearest tenth ("0.4", "0.6", "0.8", "1.0") |

**Parameters**

-   `source` **[CarmenSource](#carmensource)** a source whose indexing is complete
-   `callback` **[function](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function)** a callback function

Returns **function ([object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object))** output of `callback(stats)`

### merge

[lib/indexer/merge.js:223-445](https://github.com/mapbox/carmen/blob/3f3492d1b5bec91dd971fbe132ce847502eb99ed/lib/indexer/merge.js#L223-L445 "Source code on GitHub")

Merge two CarmenSources. The merge happens in three steps

#### Document Merge

The `Feature` documents from each source are joined and merged where
necessary. The join is a [full outer join](https://www.w3schools.com/sql/sql_join_full.asp),
meaning that all elements of the two sources are returned. A stream of
records is returned like:

    { shard: <shard_value>, data1: <from1_document>, data2: <from2_docment> }

The full outer join means:

| if a shard value...              | `data1`     | `data2`     |
| -------------------------------- | ----------- | ----------- |
| ...exists in `from1` and `from2` | `Feature`   | `Feature`   |
| ...only exists in `from1`        | `Feature`   | `undefined` |
| ...only exists in `from2`        | `undefined` | `Feature`   |

#### RocksDB grid and freq caches

see [RocksDBCache#merge](https://github.com/mapbox/carmen-cache/blob/master/API.md#rocksdbcache).

#### DAWG merge

TODO: document how dawg merge works

**Parameters**

-   `geocoder` **[Geocoder](#geocoder)** an instance of carmen Geocoder
-   `from1` **[CarmenSource](#carmensource)** a source index to be merged
-   `from2` **[CarmenSource](#carmensource)** another source to be merged
-   `to` **[CarmenSource](#carmensource)** the destination of the merged sources
-   `options` **[object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** options
-   `callback` **[function](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function)** a callback function

### multimerge

[lib/indexer/merge.js:502-586](https://github.com/mapbox/carmen/blob/3f3492d1b5bec91dd971fbe132ce847502eb99ed/lib/indexer/merge.js#L502-L586 "Source code on GitHub")

Merge more than two CarmenSources. Used by `scripts/carmen-merge.js`. Only supports MBTile sources.

**Parameters**

-   `fromFiles` **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)>** array of paths to input mbtiles files
-   `toFile` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** path to output of merge
-   `options` **[object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** options
-   `callback` **[function](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function)** a callback function

## Text Processing

The various utility functions for preparing text while indexing and querying.


### ReplaceRule

[lib/text-processing/token.js:31-137](https://github.com/mapbox/carmen/blob/3f3492d1b5bec91dd971fbe132ce847502eb99ed/lib/text-processing/token.js#L31-L137 "Source code on GitHub")

An individual pattern-based replacement configuration.

Type: [Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)

**Properties**

-   `named` **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** does the pattern use a named capturing group?
-   `from` **[RegExp](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/RegExp)** pattern to match in a string
-   `to` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** replacement string (possibly including group references)

### createGlobalReplacer

[lib/text-processing/token.js:260-275](https://github.com/mapbox/carmen/blob/3f3492d1b5bec91dd971fbe132ce847502eb99ed/lib/text-processing/token.js#L260-L275 "Source code on GitHub")

Create an array of [ReplaceRule](#replacerule)s from a [PatternReplaceMap](#patternreplacemap).

**Parameters**

-   `tokens` **[PatternReplaceMap](#patternreplacemap)** a pattern-based string replacement specification

Returns **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;[ReplaceRule](#replacerule)>** an array of rules for replacing substrings

### createReplacer

[lib/text-processing/token.js:31-137](https://github.com/mapbox/carmen/blob/3f3492d1b5bec91dd971fbe132ce847502eb99ed/lib/text-processing/token.js#L31-L137 "Source code on GitHub")

Create a per-token replacer

**Parameters**

-   `tokens` **[object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** tokens
-   `inverseOpts` **[object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** options for inverting token replacements
    -   `inverseOpts.includeUnambiguous` **[object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** options for

Returns **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;[ReplaceRule](#replacerule)>** an array of replace rules
